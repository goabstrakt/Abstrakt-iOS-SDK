# Abstrakt iOS SDK

Abstrakt's SDK, is a plug & play blockchain interface for your iOS application. Our SDK takes the responsibility of developing, managing, and maintaining much of the essential infrastructure critical from blockchain dapp development. For a high level overview of what Vault Engine offers, checkout https://goabstrakt.com/sdk/ 

This documentation can also be viewed here: http://abstakt.docs.stoplight.io. 

## Requirements

- iOS 10+
- Xcode 9+
- Swift 4.x

## Setup

1. Drag and drop **Abstrakt.framework** file in to your project.
2. Embed framework in your app. You can do this by selecting your app's `*.XcodeProj` from your project navigator. Then select Target and Add framework in the Embedded Binaries Section.
3. Create pod file and add below dependancies using [CocoaPods](https://cocoapods.org). Replace **SDKTestApp** with your app name.
   
 ```
 platform :ios, '10.0'

target 'SDKTestApp' do
  use_frameworks!

  pod 'Charts', '~> 3.1.1'
  pod 'Floaty', '~> 4.1.0'
  pod 'SwiftyJSON', '~> 4.1.0'
  pod 'SideMenu', '~> 5.0.3'
  pod 'XLActionController/Youtube', '~> 4.1.1'
  pod 'XLActionController/Periscope', '~> 4.1.1'
  pod 'IPImage', '~> 1.0.2'
  pod 'SDWebImage/WebP', '~> 4.3.3'
  pod 'DropDown', '~> 2.3.2'
  pod 'Toaster'#,'~> 2.1.1'
  pod 'Auth0', '~> 1.13.0'
  pod 'JWTDecode', '~> 2.1'
  pod 'KeychainSwift', '~> 13.0'
  pod 'CryptoSwift', '~> 0.13.1'
  pod 'BigInt', '~> 3.1'
  pod 'secp256k1.swift'
  pod 'SocketRocket'
  pod 'HockeySDK'

end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    if ['Toaster'].include? target.name
      target.build_configurations.each do |config|
        config.build_settings['SWIFT_VERSION'] = '4.0'
      end
    end
    if ['Charts'].include? target.name
      target.build_configurations.each do |config|
        config.build_settings['SWIFT_VERSION'] = '4.0'
      end
    end
  end
end
```
4. Then run the following command:
    ``` $ pod install ```
5. When compiling the framework for the app store, you will need to run a script to sign all the code. Contact the Abstrakt team for details.

**Note:** `Abstrakt.shared` is used to access the Abstrakt framework as singleton. Currently all functions need to be accessed using **'.shared'**

## Abstrakt SDK Primitive Concepts

This section covers the powerful features built into Abstrakt SDK. 

#### User Accounts 
A user account is created using a unique identifier generated by oAUTH authentication. Applications can easily on-board users with their existing Facebook/Google/etc logins. You can think of a user account as the parent to all other data. A user account associates users' public keys with human readable names, keeps track of a users' contacts and stores metadata (name, email, avatar, phone number). **Mnemonics/Private keys are never stored or transmitted to Abstrakt**. Mnemonics are securely generated by the client side SDK and are backed up by the user. Mnemonics can be imported by the user as well. Users can create unlimited 'Wallet Accounts' of any supported blockchain from their mnemonic. When a user is deleted from the device, the SDK deletes all user data including accounts, mnemonic, private keys, cached transaction information. 

#### Accounts 
A 'wallet account' is a single public + private key pair & associated metadata. An account is 'named' by user on creation. Conceptually, you can think of this as a child object of a User Account, because each account is associated with a User. 
> `Account` is an object representing the `publicAddress`, `blockchainId` and `nickname` 

#### Shared Accounts
A shared account is a wallet account that is shared by a user to another user via a 'connection'. Only the public key & nickname is shared with the other user. Private keys always remain encrypted on the user's device. Shared accounts allow users to transact with each other without external communication of public addresses which is error prone, insecure, and unacceptable UX.
> `SharedAccount` is an object representing the `publicAddress`, `blockchainId`, `nickname`, and `otherUserId`

#### Connections
Connections are basically 'friends'. Connections can be sent, received, accepted, denied and removed. Flow: User searches for another user by querying a name, email using the SDK. Next, the user sends a connection request to the userId found. The otherUser can choose to accept or decline the connection. Finally the users can share accounts and begin transacting. Note that users include: peers, businesses, merchants etc. - anyone integrating with Abstrakt.

#### Market Data
The SDK provides real-time market data for all supported blockchains in USD. Application developers don't have to worry about other data sources.  More currencies denominations will be added. (EUR, KRW etc.) 

#### Transaction Data
Abstrakt provides rich transaction data from all supported blockchains. When a user adds a wallet account, all historical transactions associated with that account will be sent to the user. Smart contract data is coming soon.

#### Caching Data
Abstrakt SDK automatically caches all user data on the client device! As a result, application developers have access to all synced user data `offline`. This is a significant performance and user experience improvement for your application!

## QuickStart
This sample code demonstrates how to autheticate a user and call SDK functions onces the framework is setup. 

*Note:* Abstrakt.**shared** is used to access the Abstrakt framework as singleton. Currently all functions need to be accessed using **'shared'**
```swift

import UIKit
import AbstraktSDK

class ViewController: UIViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view.
        
        
        // Step 1: Authenticate user to abstrakt services 
        Abstrakt.shared.authenticateWithEmailAndPassword(email: "daniel@testgmail.com", password: "testingpassword", completion: { (status) in
            if status == "success" {
                print("Authenticated successfully")
            } else {
                print("failed to authenticate")
            }
        }


        // Step 2: Generate new mnenonic seed for user. User must save the mnemonic. Mnemonic is required to recover account.
        let generatedMnemonic = Abstrakt.shared.createMnemonic()

        // Step 3: Generate ethereum account from mnemonic  
        let nickName = "AccountName"
        Abstrakt.shared.createAccount(nickName: nickName, blockchainNetwork: BlockchainNetwork.EthMainnet)  { (status) in
            if status {
                print("Account created successfully")
            } else {
                print("Failed to create account")
            }
        }

        // Step 4: Check your created accounts
        Abstrakt.shared.getMyAccounts(isTestnetEnabled: false) { (accounts) in
            print("account count \(accounts.count)")                
        }

        // Deletes all local data including user mnemonic, accounts and cached data. Make sure user has backed up mnemonic before logout
        Abstrakt.shared.logout(); 
        
    }

    
}
```

## Authentication

Authentication functions to login/logout, get user info and check status.

#### Authenticate user
These functions authenticate the user and connect the client via MQTT to Abstrakt'a services.

Login/Create new user account by authenticating with Auth0. This function creates a new account for new users and logs in existing users. 
<table>
  <tr><th><b>Parameter</b></th><th><b>Description</b></th></tr>
  <tr><td>email</font></td><td>username & email of user</td></tr>
  <tr><td>password</td><td>user password must have at least 8 characters, 1 lower case, 1 upper case, 1 special character</td></tr>
  <tr><th><b>Return</b></th><th><b>Description</b></th></tr>
  <tr><td>string</td><td>returns *success* or *nil* if authentication failed</td></tr>
</table>

```swift
Abstrakt.shared.authenticateWithEmailAndPassword(email: String, password: String, completion: @escaping (String) -> Void)
```
Login/Create new user account by authenticating with Auth0 social auth. This function redirects the user to a social authentication login.
<table>
  <tr><th><b>Parameter</b></th><th><b>Description</b></th></tr>
  <tr><td>audience</td><td>auth0 API url that your application will use for authentication. Don't set parameter to use default value.</td></tr>
  <tr><th><b>Return</b></th><th><b>Description</b></th></tr>
  <tr><td>string</td><td>returns *success* or *nil* if authentication failed</td></tr>
</table>

```swift
Abstrakt.shared.authenticate(audience: String, completion: @escaping (String?) -> Void)
````

#### Check if user is already authenticated
```swift
Abstrakt.shared.hasCredentials() -> Bool
```
#### Get User's Id
```swift
Abstrakt.shared.getUserId() -> String
```
#### Get User Avatar
```swift
Abstrakt.shared.getUserAvatar() -> String
```
#### Get User Name
```swift
Abstrakt.shared.getUserName() -> String
```
#### Get User Email
```swift
Abstrakt.shared.getUserEmail() -> String
```
#### Logout and Wipe all local stored data
```swift
Abstrakt.shared.logout()
```

## Network Connectivity 
Check if SDK is connected to Abstrakt Services
```swift
Abstrakt.shared.getConnectionStatus() -> Bool
```

## Mnemonic
A mnemonic is a human readable list of words that generates a master seed, that in turn, generates wallet accounts for users. It is critical that a mnemonic must be backed-up by the user, as soon as it is generated. If the user's account is deleted from their device, or if the device is lost, the mnemonic is not recoverable! It is the key to accessing a user's wallet accounts. We are working on cloud-backup using the iOS/Android keystore for users with smaller account balances.

#### Generate a Mnemonic seed  
Creates a random mnemonic string. Returned string can be displayed to the user for backup. 
*After calling `createMnemonic`, call `createAccount` to create the first account using this mnemonic.*
```swift
Abstrakt.shared.createMnemonic() -> String
```
#### Import Mnemonic 
This function imports an mnemonic to the device. The user can type in their mnemonic and recover previously generated accounts or import accounts from another device.
**Two Cases:**
1. The user already has accounts previously created from this menmonic in SDK. (function `getMyAccounts` returns accounts)
    * In this case, private keys of existing accounts are automatically generated using the imported menmonic.
2. The user does not have existing accounts generated earlier. 
    * In this case, *nickName* and *blockchainNetwork* can be set to create first account. If unset, defaults will be used to create first account. 

*Note: only one mnemonic is support at this time. multi-mnemonic support will be added soon.*

<table>
  <tr><th><b>Parameter</b></th><th><b>Description</b></th></tr>
  <tr><td>isTestnetEnabled</td><td>if enabled will generate testnet work accounts and mainnet accounts of existing accounts</td></tr>
  <tr><td>mnemonic</td><td>mnemonic string to import</td></tr>
  <tr><td>nickName</td><td>optional name of first account created using mnemonic. Both blockchainNetwork and nickName have to be specifed or either.</td></tr>
  <tr><td>blockchainNetwork</td><td>optional blockchain network of first account created.</td></tr>
  <tr><th><b>Return</b></th><th><b>Description</b></th></tr>
  <tr><td>boolean</td><td>returns true = success or false = failed</td></tr>
</table>

```swift
Abstrakt.shared.importMnemonic(isTestnetEnabled: Bool = false, mnemonic: String, nickName: String, blockchainNetwork: BlockchainNetwork, completion: @escaping (Bool) -> Void)
```
#### Get Mnemonic
This function returns generated/imported menmonic encrypted on the device. It can be displayed to the user for backing up. 
```swift
Abstrakt.shared.getMnemonic(completion: @escaping (String) -> Void)
```
#### Cloud backup (work in progress..)
This function will enable you to encrypt the user generated mnenomnic with a password and store it to the apple keychain. 
#### Recover cloud backup (work in progress..)
Once a mnenomic is encrypted and backuped to the user's apple keychain, it can be recovered automatcially on future logins. 

## Account Management 
#### Generate Account public/private keypair from a Mnemonic
Create account can be called after generating or importing the mnemonic which is the master seed. If the mnemonic does not exist on device, an error will be returned. 
```swift
Abstrakt.shared.createAccount(nickName: String, blockchainNetwork: BlockchainNetwork, completion: @escaping (Bool) -> Void)
```
#### Remove Account
Removing an account deletes the private/public key pair from the device and from the user's profile. 
Note that deleting the last account, will delete the mnemonic that was used to generate the account as well. Hence, if the last account is deleted, all private keys and mnemonics are deleted from device. 
```swift
Abstrakt.shared.removeAccount(blockchainNetwork: BlockchainNetwork, accountAddress: String)
```
#### Get Account Balance
This function gets the account balance of any account the logged in user has in their acccount.
```swift
Abstrakt.shared.getAccountBalance(accountAddress: String, blockchainNetwork: BlockchainNetwork, completion: @escaping (_ accountBalance: Double, _ accountConversionBalance: Double) -> Void)
```
#### Get Account Object
Return Account Object 
```swift
Abstrakt.shared.getMyAccounts(isTestnetEnabled: Bool, completion: @escaping ([Account]) -> Void)
```
#### Get Account Keys
Work in Progress - Will return public & private keys of specified account


## Transactions 
#### Get Transactions from all accounts of specified blockchain networks 
```swift
Abstrakt.shared.getTransactions(blockchainNetwork: [Strings], completion: @escaping ([EthereumTransaction]) -> Void)
```
####  Get Transactions from a specific account
```swift
Abstrakt.shared.getTransactionsFromAccount(accountAddress: String, blockchainNetwork: BlockchainNetwork, completion: @escaping ([EthereumTransaction]) -> Void)
```
#### Send Transaction
Send transaction by specifying the from address, to address, the blockchain network, and value in ether.   

<table>
  <tr><th><b>Parameter</b></th><th><b>Description</b></th></tr>
  <tr><td>blockchainNetwork</td><td>if enabled will generate testnet work accounts and mainnet accounts of existing accounts</td></tr>
  <tr><td>fromAccountAddress</td><td>public address of account to transfer from</td></tr>
  <tr><td>toAccountAddress</td><td>public address of account to transfer to</td></tr>
  <tr><td>amountToTransfer</td><td>amount in ether to transfer</td></tr>
  <tr><th><b>Return</b></th><th><b>Description</b></th></tr>
  <tr><td>boolean</td><td>returns true = success or false = failed</td></tr>
</table>

```swift
Abstrakt.shared.sendTransaction(blockchainNetwork: BlockchainNetwork, fromAccountAddress: String, toAccountAddress: String, amountToTransfer: String, completion: @escaping (Bool) -> Void)
```

## Market Data
Returns the USD market value of the specified blockchain network
```swift
Abstrakt.shared.getMarketValue(by blockchainNetwork: BlockchainNetwork) -> MarketValue?
```

## Delegates 
Documentation being added. 




